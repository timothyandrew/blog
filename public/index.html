
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Timothy's Blog</title>
  <meta name="author" content="Timothy Andrew">

  
  <meta name="description" content="Introduction Now that we know that the American government is probably reading all our email, we should be encrypting all sensitive emails that we &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.timothyandrew.net/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Timothy's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39904863-1', 'timothyandrew.net');
    ga('send', 'pageview');

  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.timothyandrew.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            Timothy's Blog
        </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/13/encrypt-your-emails-on-os-x/">Encrypt Your Emails on OS X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-13T23:14:00+05:30" pubdate data-updated="true">Aug 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Introduction</h3>

<p>Now that we know that the American government is <a href="http://en.wikipedia.org/wiki/PRISM_(surveillance_program)">probably reading all our email</a>, we should be encrypting all sensitive emails that we send.
At the very least, we should be signing all the email that we send, so that it can&#8217;t be changed en route.</p>

<p>This guide assumes that you&#8217;re using a <a href="http://en.wikipedia.org/wiki/Mail_(application)">Mail.app</a> on a Mac, although similar tools exist for Windows and Linux.</p>

<p>First, for those who are unfamiliar with this, here&#8217;s an (oversimplified) explanation of how encryption works.</p>

<p>A <a href="http://en.wikipedia.org/wiki/Cryptographic_key">key</a> is a randomly generated string of characters which is used to encrypt/decrypt your data.
Every user has a pair of keys. His <em>public key</em> can be freely shared online. His <em>private key</em> is known only to him, and must be safely stored.</p>

<p>Let&#8217;s consider the classic Alice and Bob example.</p>

<ul>
<li>Alice wants to send a message to Bob</li>
<li>Alice combines her <em>private key</em> with Bob&#8217;s <em>public key</em> to generate a <em>shared secret</em></li>
<li>Alice encrypts her message with the shared secret and sends it to Bob.</li>
<li>Now the way this works, the same shared secret can also be generated by combining Bob&#8217;s <em>private key</em> and Alice&#8217;s <em>public key</em></li>
<li>This means that the message can be decrypted by Bob (assuming he has Alice&#8217;s private key)</li>
</ul>


<p>So, in practice, this means:</p>

<ul>
<li>You need a private/public key pair</li>
<li>The person you&#8217;re sending email to needs a private/public key pair</li>
<li>You need to know the public key of the person you&#8217;re sending email to</li>
<li>That person needs to know your public key</li>
<li>Additionally, your private key is usually encrypted on disk, so you need a password (sometimes called a passphrase) to unlock your private key.</li>
</ul>


<h3>Generating a Key Pair</h3>

<p>First, download and install <a href="https://gpgtools.org/">GPG Suite</a>. Then, the <em>GPG Keychain Access</em> application. This should be present in your <em>Applications</em> folder after you install the GPG Suite.</p>

<p>Click on <em>New</em>, and enter your Name and Email address. <em>Upload public key after generation</em> should be checked. You will also need to pick a passphrase to secure your private key on disk.</p>

<p>You should now have a key pair generated for you. To be safe, use <em>GPG Keychain Access</em> to export your key to a file. Make sure that the <em>Allow secret key export</em> option is checked. This makes sure that your private key is exported as well. This will create a file with an <code>asc</code> extension. Keep this file safe!</p>

<p>Remember, if you lose your private key, you cannot read any encrypted mail sent to you, nor can you send any encrypted email. Ditto for your passphrase.
I use <a href="www.haystacksoftware.com/arq/">Arq</a> to backup my private keys and <a href="https://agilebits.com/onepassword">1Password</a> for my passphrase.</p>

<h3>Getting Another Person&#8217;s Public Key</h3>

<p>You cannot send an encrypted email to someone unless you know their public key.</p>

<p>To do this, open <em>GPG Keychain Access</em>, and press <em>⌘F</em> to launch the Find dialog. Enter the email address of the person you want to email.
Once the search completes, you can import the public key for the email you entered.</p>

<p>You can also do this manually using a key server like http://pgp.mit.edu/</p>

<h3>Sending an Encrypted Email</h3>

<p>Open/Restart Mail.app. Type <em>⌘N</em> to compose a new mail.
If you set up your keys right, you should see a green <code>OpenPGP</code> on the top right corner of the window.</p>

<p>Once you fill in the <em>To:</em> field with an email address you know the public key for, the little padlock icon on the right should become clickable. Click it.</p>

<p><img src="/images/encryption/2.png" alt="Padlock Icon" /></p>

<p>If the padlock is closed, that means that the email you&#8217;re about to send is encrypted.</p>

<p>The person you&#8217;re sending the email to should be able to view the email as normal (using software like GPG Suite to handle decryption).</p>

<p>If someone else were to try and view the email, this is what they would see:</p>

<p><img src="/images/encryption/3.png" alt="Un-Decrypted View" /></p>

<h3>Receiving an Encrypted Email</h3>

<p>Thankfully, there&#8217;s nothing you have to do here, assuming you have the sender&#8217;s public key imported into GPG Keychain Access.
GPG Suite will automatically decrypt the email and show it to you. It&#8217;s seamless!</p>

<p>In fact, here&#8217;s what the email from the previous screenshot would look like in Mail.app:</p>

<p><img src="/images/encryption/4.png" alt="Decrypted Email" /></p>

<h3>Digital Signatures</h3>

<p>It might not always be practical/necessary to encrypt all your emails.</p>

<p>However, there is an easy way to avoid MITM attacks (man-in-the-middle attacks, where a third-party could modify the text of the email before it reaches you).</p>

<p>Simply <a href="http://en.wikipedia.org/wiki/Digital_signature">(digitally) sign</a> every email you send. GPG Suite makes this very easy. Just make sure the button next to the padlock is clicked:</p>

<p><img src="/images/encryption/5.png" alt="Signature Button" /></p>

<p>Here&#8217;s what this does:</p>

<ul>
<li>The text of your message is applied to a one-way function, and a <em>digital fingerprint</em> of your message is obtained.</li>
<li>If the text of your message changes even by a single character, this fingerprint ceases to be valid.</li>
<li>The fingerprint is signed with your private key, and is attached with the email in a plain-text file called <code>signature.asc</code></li>
<li>The receiver independently calculates the fingerprint of the message, and also decrypts your <code>signature.asc</code> using your public key.</li>
<li>If the two match, the email was sent by you, and was not tampered with.</li>
</ul>


<p>An email client that supports digital signatures (GPG Suite included) will complain if this verification fails.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/11/pow-over-https/">Pow Over HTTPS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-11T12:26:00+05:30" pubdate data-updated="true">Jul 11<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I use <a href="http://pow.cx">Pow</a> to manage web servers on my development machine. It works pretty well.
To start my server, I just hit a URL like <code>http://surveyweb.dev</code>, which starts the server (if it isn&#8217;t running) and spins it down automatically in 5 minutes.</p>

<p>It doesn&#8217;t work over HTTPS by default; here&#8217;s how you get that done.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem install tunnels
</span></code></pre></td></tr></table></div></figure>


<p>This gem lets you route traffic from one port to another port.</p>

<p>We need to route traffic from port 443, to port 80 (where the Pow server runs).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo tunnels 443 80
</span></code></pre></td></tr></table></div></figure>


<p>While the tunnel is open, I can access <code>https://surveyweb.dev</code> just fine.</p>

<p>Pow also has a feature where I can access my server from another machine on the LAN using a URL like <code>http://surveyweb.192.168.1.10.xip.io/</code> where <code>192.168.1.10</code> is the IP address of my machine. Even with the tunnel open, HTTPS doesn&#8217;t work for this URL.</p>

<p>We need to start another tunnel:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo tunnels 192.168.1.10:443 127.0.0.1:80 <span class="c"># Replace 192.168.1.10 with your IP address</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now, both URLs work over HTTPS.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/10/using-roboguice-to-inject-views-into-a-pojo/">Using RoboGuice to Inject Views Into a POJO</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-10T10:50:00+05:30" pubdate data-updated="true">Jul 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/roboguice/roboguice">RoboGuice</a> is great. It lets you get rid of code like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Button</span> <span class="n">mSignInButtonView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mSignInButtonView</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sign_in_button</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead, with a single line, RoboGuice will take care of injecting that view into your activity:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="n">RoboActivity</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@InjectView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sign_in_button</span><span class="o">)</span> <span class="n">Button</span> <span class="n">mSignInButtonView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// I have a reference to mSignInButtonView here.</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&#8217;re rewriting <a href="http://github.com/nilenso/ashoka-survey-mobile">ashoka-survey-mobile</a> as a layered <a href="(http://github.com/nilenso/ashoka-survey-mobile-native">native app</a>).
We have a LoginView (POJO) which needs references to views present on-screen. Normally, we would instantiate the POJO in the activity, and pass it all the views it needs.</p>

<p>But can we do this with RoboGuice? We can&#8217;t really use <code>@InjectView</code> in a POJO. It needs an Activity context.
The next best thing is to inject the activity into the POJO (RoboGuice is smart enough to inject the correct activity), and pick the views manually using <code>findViewById</code>.</p>

<p>So in the activity:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="n">RoboActivity</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Inject</span> <span class="n">LoginView</span> <span class="n">loginView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">loginView</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span> <span class="c1">// Need to manually build up the view references inside LoginView</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and in <code>LoginView</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginView</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Inject</span> <span class="n">Activity</span> <span class="n">activity</span><span class="o">;</span> <span class="c1">// This gets injected with the correct instance of LoginActivity</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Button</span> <span class="n">buttonView</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">EditText</span> <span class="n">editText</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">buttonView</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">my_button</span><span class="o">);</span>
</span><span class='line'>        <span class="n">editText</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">my_edit_text</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then your POJO can manipulate the views that are on-screen as required.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/24/recursive-postgres-queries/">Recursive Postgres Queries</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-24T08:30:00+05:30" pubdate data-updated="true">Jun 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Introduction</h3>

<p>At <a href="http://nilenso.com/">Nilenso</a>, I&#8217;m working on an (<a href="http://github.com/nilenso/ashoka-survey-web">open-source!</a>) app to design and conduct surveys.</p>

<p>Here&#8217;s a simple survey being designed:</p>

<p><a href="/images/recursive-pg/survey-overview.png"><img src="/images/recursive-pg/survey-overview.png" alt="Survey Builder Overview" /></a></p>

<p>Internally, this is represented as:</p>

<p><a href="/images/recursive-pg/internal-survey-overview.png"><img src="/images/recursive-pg/internal-survey-overview.png" alt="Survey Model Overview" /></a></p>

<p>A survey is made up of many <em>questions</em>. A number of questions can (optionally) be grouped together in a <em>category</em>. Our actual data model is a bit more complicated than this (sub-questions, especially), but let&#8217;s assume that we&#8217;re just working with questions and categories.</p>

<p>Here&#8217;s how we preserve the ordering of questions and categories in this survey.</p>

<p>Each question and category has an <code>order_number</code> field. It&#8217;s an integer that specifies the relative ordering of itself and its siblings.</p>

<p>For example, in this case,</p>

<p><a href="/images/recursive-pg/order-number-overview.png"><img src="/images/recursive-pg/order-number-overview.png" alt="Order Number Overview" /></a></p>

<p>the question <code>Bar</code> will have an <code>order_number</code> that is <em>less than</em> the order number of <code>Baz</code>.</p>

<p>This guarantees that the a category can fetch its sub-questions in the right order:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># In category.rb</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">sub_questions_in_order</span>
</span><span class='line'>  <span class="n">questions</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;order_number&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In fact, this is how we fetch the entire survey at this point. Each category calls <code>sub_questions_in_order</code> on each of its children, and so on down the entire tree.</p>

<p>This gives us a depth-first ordering of this tree:</p>

<p><a href="/images/recursive-pg/naive-order.png"><img src="/images/recursive-pg/naive-order.png" alt="Naive Ordering" /></a></p>

<p>For large surveys with 5+ levels of nesting, and more than a hundred questions, this is pretty slow.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/24/recursive-postgres-queries/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/09/turning-your-local-git-repo-into-a-remote/">Turning Your Local Git Repo Into a Remote</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-09T20:18:00+05:30" pubdate data-updated="true">May 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Need to pull some changes from a friend&#8217;s local Git repo without having to push to <code>origin</code>? This post will show you how to do that.</p>

<p>You can access a local Git repo using SSH, but setting up keys and such will probably take some time. For a quick-and-dirty solution, HTTP is <em>much</em> easier.</p>

<p>On the machine you want to use as the server, navigate to your project and then into the <code>.git</code> directory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /path/to/project
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> .git
</span></code></pre></td></tr></table></div></figure>


<p>Stand up a HTTP server using Python&#8217;s <code>SimpleHTTPServer</code> module. You can use any port number you like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python -m SimpleHTTPServer 5000
</span></code></pre></td></tr></table></div></figure>


<p>You&#8217;ll need the IP address of this machine as well. (Use <code>ifconfig</code>)</p>

<p>Make sure you can access the python server from a browser on the client machine. You should be able to see something like this at <code>http://ip.address:5000/</code></p>

<p><img src="images/2013-05-09-python-server.png" alt="Python Server Browser Screenshot" /></p>

<p>On the client, you should be now able to access the git repo over HTTP as though it were a normal git remote.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git ls-remote http://ip.address:5000
</span><span class='line'><span class="nv">$ </span>git pull http://ip.address:5000 master
</span></code></pre></td></tr></table></div></figure>


<p>Add it as a remote to avoid typing out the entire IP each time.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote add http://ip.address:5000 <span class="nb">local</span>-foo
</span><span class='line'><span class="nv">$ </span>git pull <span class="nb">local</span>-foo master
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/01/writing-custom-rspec-matchers/">Writing Custom RSpec Matchers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-01T11:56:00+05:30" pubdate data-updated="true">May 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>RSpec matchers let you abstract away common assertions in your test code.</p>

<p>For example, we recently had a spec file with a bunch of lines that looked like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="kp">include</span> <span class="s2">&quot;Foo&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which tests if the excel file we&#8217;re generating (using <a href="https://github.com/randym/axlsx">axlsx</a>) includes <code>Foo</code> in the header row.</p>

<p>That isn&#8217;t very neat. What if we replace it with this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">should</span> <span class="n">have_header_cell</span> <span class="s2">&quot;Foo&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That looks a lot better. We can implement this kind of abstraction using custom RSpec matchers.</p>

<p>The matcher for this is as simple as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:have_header_cell</span> <span class="k">do</span> <span class="o">|</span><span class="n">cell_value</span><span class="o">|</span>
</span><span class='line'>  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">worksheet</span><span class="o">|</span>
</span><span class='line'>    <span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">cell_value</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>RSpec passes in the expected and actual values to these blocks, and our code has to return a boolean representing the result of the assertion.</p>

<p>Now what about assertions that look like this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="kp">include</span> <span class="s2">&quot;Foo&quot;</span>
</span><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="kp">include</span> <span class="s2">&quot;Bar&quot;</span>
</span><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="mi">3</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="kp">include</span> <span class="s2">&quot;Baz&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The row that we&#8217;re checking changes for each assertion. Of course, we <em>could</em> create a different matcher for each of these cases, but there&#8217;s a better way.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">should</span> <span class="n">have_cell</span><span class="p">(</span><span class="s2">&quot;Foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">in_row</span> <span class="mi">1</span>
</span><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">should</span> <span class="n">have_cell</span><span class="p">(</span><span class="s2">&quot;Bar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">in_row</span> <span class="mi">2</span>
</span><span class='line'><span class="n">worksheet</span><span class="o">.</span><span class="n">should</span> <span class="n">have_cell</span><span class="p">(</span><span class="s2">&quot;Baz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">in_row</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>RSpec lets you <em>chain</em> custom matchers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:have_cell</span> <span class="k">do</span> <span class="o">|</span><span class="n">expected</span><span class="o">|</span>
</span><span class='line'>  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">worksheet</span><span class="o">|</span>
</span><span class='line'>    <span class="n">worksheet</span><span class="o">.</span><span class="n">rows</span><span class="o">[</span><span class="vi">@index</span><span class="o">].</span><span class="n">cells</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">expected</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">chain</span> <span class="ss">:in_row</span> <span class="k">do</span> <span class="o">|</span><span class="n">index</span><span class="o">|</span>
</span><span class='line'>    <span class="vi">@index</span> <span class="o">=</span> <span class="n">index</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">failure_message_for_should</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;Expected </span><span class="si">#{</span><span class="n">actual</span><span class="si">}</span><span class="s2"> to include </span><span class="si">#{</span><span class="n">expected</span><span class="si">}</span><span class="s2"> at row </span><span class="si">#{</span><span class="vi">@index</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We first store the argument passed in to <code>in_row</code> as an instance variable, and then access it in the main <code>have_cell</code> matcher.</p>

<p>The example also includes a custom error message handler, which properly formats an error message if the assertion fails.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/28/yaml-serialization-for-delayed-job/">YAML Serialization for Delayed Job</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-28T08:08:00+05:30" pubdate data-updated="true">Apr 28<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When we first moved excel generation off to a delayed job on <a href="http://github.com/c42/survey-web">survey-web</a>, we had code that looked like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">responses</span> <span class="o">=</span> <span class="no">Response</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="n">bar</span><span class="p">)</span>
</span><span class='line'><span class="ss">Delayed</span><span class="p">:</span><span class="ss">:Job</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="no">MyCustomJob</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this would bomb with an error like <code>Can't dump anonymous Module</code>.<br/>
After some time getting nowhere, we solved it like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">response_ids</span> <span class="o">=</span> <span class="no">Response</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="n">bar</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:id</span><span class="p">)</span>
</span><span class='line'><span class="ss">Delayed</span><span class="p">:</span><span class="ss">:Job</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="no">MyCustomJob</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">response_ids</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And in the job:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">responses</span> <span class="o">=</span> <span class="no">Response</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;id in (?)&#39;</span><span class="p">,</span> <span class="n">response_ids</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>While refactoring a lot of that code over the last few days, we ran into the same issue. But with one difference. A controller spec was failing, but a test for the job which also passed a bunch of responses into it passed.</p>

<p>We wondered if maybe it was because we were passing a relation into the job instead of an array.</p>

<p>So we tried:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">responses</span> <span class="o">=</span> <span class="no">Response</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="n">bar</span><span class="p">)</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'><span class="ss">Delayed</span><span class="p">:</span><span class="ss">:Job</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="no">MyCustomJob</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that worked great.</p>

<p>(The files in question are <a href="https://github.com/c42/survey-web/blob/master/app/controllers/responses_controller.rb#L16">here</a> and <a href="https://github.com/c42/survey-web/blob/master/app/models/reports/excel/job.rb%22">here</a>).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/12/changing-the-server-timeout-on-engineyard/">Changing the Server Timeout on EngineYard</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-12T22:29:00+05:30" pubdate data-updated="true">Apr 12<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While working on <a href="http://github.com/c42/survey-web">survey-web</a> today, we were stuck for a really long time trying to figure out this problem.</p>

<p>Unless otherwise specified, image uploads while adding a response are capped at 5MB per image.
Adding a larger image (like this 20MB image) should result in a validation error showing up.</p>

<p><img src="/images/2013-04-12-image-too-big.png" alt="Validation Error" /></p>

<p>On production, we&#8217;d see this.</p>

<p><img src="/images/2013-04-12-502.png" alt="Production" /></p>

<p>After a <em>lot</em> of digging, including looking at Carrierwave (and <a href="https://github.com/lardawge/carrierwave_backgrounder">Backgrounder</a>), delayed_job server logs, and our controller logic pretty closely, we noticed in <code>production.log</code> that Rails was sending down a <code>200</code>, but the browser was recieving a <code>502</code>.</p>

<p><code>unicorn.log</code> showed that a worker process was being killed with a <code>SIGIOP</code> whenever the error page showed up.</p>

<p>Only then did we realise that the worker was being killed around 60s every time. It had to be a timeout issue.</p>

<p>On EngineYard, the unicorn config already had:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># sets the timeout of worker processes to +seconds+.  Workers</span>
</span><span class='line'><span class="c1"># handling the request/app.call/response cycle taking longer than</span>
</span><span class='line'><span class="c1"># this time period will be forcibly killed (via SIGKILL).  This</span>
</span><span class='line'><span class="c1"># timeout is enforced by the master process itself and not subject</span>
</span><span class='line'><span class="c1"># to the scheduling limitations by the worker process.  Due the</span>
</span><span class='line'><span class="c1"># low-complexity, low-overhead implementation, timeouts of less</span>
</span><span class='line'><span class="c1"># than 3.0 seconds can be considered inaccurate and unsafe.</span>
</span><span class='line'><span class="n">timeout</span> <span class="mi">180</span>
</span></code></pre></td></tr></table></div></figure>


<p>The server didn&#8217;t seem to be following this configuration.</p>

<p>After a fair bit of googling and help from the <code>#engineyard</code> IRC channel, this is what we did to fix it.<br/>
Add the following lines to <code>/data/nginx/nginx.conf</code> inside the <code>http{}</code> block (replacing 300 with the timeout you need).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='nginx'><span class='line'><span class="k">client_header_timeout</span> <span class="mi">300</span><span class="p">;</span>
</span><span class='line'><span class="k">client_body_timeout</span> <span class="mi">300</span><span class="p">;</span>
</span><span class='line'><span class="k">send_timeout</span> <span class="mi">300</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And restart nginx/unicorn with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /etc/init.d/nginx reload
</span><span class='line'><span class="nv">$ </span>/engineyard/bin/app_&lt;app_name&gt; reload
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/08/use-lambdas-for-date-based-rails-scopes/">Use Lambdas for Date-based Rails Scopes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-08T00:26:00+05:30" pubdate data-updated="true">Apr 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A scope allows you to specify an ARel query that can be used as a method call to the model (or association objects).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:delivered</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="ss">delivered</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Item</span><span class="o">.</span><span class="n">delivered</span><span class="o">.</span><span class="n">to_sql</span>                     <span class="c1"># SELECT &quot;items&quot;.* FROM &quot;items&quot;  WHERE &quot;items&quot;.&quot;delivered&quot; = &#39;t&#39;</span>
</span><span class='line'><span class="no">Item</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">price</span><span class="p">:</span> <span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">delivered</span><span class="o">.</span><span class="n">to_sql</span>  <span class="c1"># SELECT &quot;items&quot;.* FROM &quot;items&quot;  WHERE &quot;items&quot;.&quot;price&quot; = 2000 AND &quot;items&quot;.&quot;delivered&quot; = &#39;t&#39; </span>
</span></code></pre></td></tr></table></div></figure>


<p>There&#8217;s a problem if we try using a scope for a relative date, though.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:expired</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;expiry_date &lt; ?&quot;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code gets evaluated when the server is started, and the <em>output</em> of <code>Date.today</code> is stored in the scope.</p>

<p>That scope is equivalent to the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">expired</span>
</span><span class='line'>    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;expiry_date &lt; ?&quot;</span><span class="p">,</span> <span class="s2">&quot;2013-04-01&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The date is hardcoded in there, and will not be changed until the scope is re-evaluated.<br/>
This typically happens only when the server is restarted.</p>

<p>To get around this problem, use a lambda when defining date (or time) based scopes. This will force the evaluation of the scope each time it is <em>called</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:expired</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;expiry_date &lt; ?&quot;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/06/using-asana-from-a-cheap-nokia-phone/">Using Asana From a Cheap Nokia Phone</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-06T23:29:00+05:30" pubdate data-updated="true">Apr 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I love <a href="http://asana.com/">Asana</a>. Its made me a lot more organized than I used to be.</p>

<p>I&#8217;d love to be able to check my tasks when I&#8217;m not at a computer, but my phone looks like this.</p>

<p><img src="/images/c2-01.jpg" alt="Nokia C2-01" /></p>

<p>There&#8217;s no way the Asana app will load on its Opera Mini browser.</p>

<p>It does have email, though. And Asana lets me <a href="http://asana.com/guide/tags-email/email-basics">send tasks</a> in via email.</p>

<p>Unfortunately, there seems to be no way to actually <em>view</em> all your tasks from a phone like this.</p>

<p><strong>Until now.</strong></p>

<p>I wrote a small <a href="http://sinatrarb.com/">Sinatra</a> app that pulls my tasks from Asana and displays them on a simple HTML page. It&#8217;s very rough around the edges, but works well enough for my needs. You can grab the code and set it up <a href="http://github.com/timothyandrew/asana-light">here</a>.</p>

<p>There is <strong><em>no</em> authentication</strong> yet, so anyone with a link can view your tasks.</p>

<p>Read on for an explanation of how it works.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/04/06/using-asana-from-a-cheap-nokia-phone/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/13/encrypt-your-emails-on-os-x/">Encrypt Your Emails on OS X</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/11/pow-over-https/">Pow Over HTTPS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/10/using-roboguice-to-inject-views-into-a-pojo/">Using RoboGuice to Inject Views Into a POJO</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/24/recursive-postgres-queries/">Recursive Postgres Queries</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/09/turning-your-local-git-repo-into-a-remote/">Turning Your Local Git Repo Into a Remote</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/timothyandrew">@timothyandrew</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'timothyandrew',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
  <h1>About</h1>
      <p>
        Timothy has been vaguely passionate about computers ever since he got all the way through Prince of Persia when
        he was five. This grew into a legitimate love for the field after he crashed his Windows box in 2007 and managed
        a fragile triple-boot system that included a
        <a href="http://en.wikipedia.org/wiki/OSx86">patched version of OS X</a>.
      </p>
      <p>
        While he was slacking off from doing his mostly-meaningless Computer Science degree, he discovered an
        <a href="http://github.com/timothyandrew">interest for coding</a>, and there was no looking back.
      </p>
      <p>
        Having graduated recently, he&#8217;s eager to put in his <a href="http://norvig.com/21-days.html">10,000 hours</a>
        and finally get some real-world experience.
      </p>
      <a href="http://nilenso.com"><img src="http://nilenso.com/nilenso-200.png"></a>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Timothy Andrew -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'timothysblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
